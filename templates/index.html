<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mdau5h's Notebook</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

</head>
<body>
    <div class="container">
        <h1 class="mb-3 mt-5">Welcome to Mdau5h's Notebook!</h1>
        <div class="row mb-3">
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">My note will be called:</label>
                <input id="noteTitle" type="text" class="form-control" placeholder="Title">
            </div>

            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">So:</label>
                <textarea id="noteContent" class="form-control" id="exampleFormControlTextarea1" rows="3" placeholder="Text..."></textarea>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button id="addNote" type="button" class="btn btn-primary">Add</button>
            </div>
        </div>


        <div id="notes" class="container">
<!--            <div id="note" class="row mb-3 card text-bg-light mb-3" >-->
<!--                <button onclick="deleteNote" type="button" class="btn-close" aria-label="Close" style="font-size: 20px; position: absolute;left: 1079px;-->
<!--    top: 5px"></button>-->
<!--                <label class="form-check-label fs-2 mb-1 mt-1">-->
<!--                   This is the title-->

<!--                </label>-->
<!--                <label class="form-check-label fs-6 mb-2 mt-1">-->
<!--                    And this is an actual note-->
<!--                </label>-->
<!--            </div>-->
        </div>
    </div>
    <script type="text/javascript">
        document.getElementById("addNote").addEventListener('click', async() => {
            const inputTitle = document.getElementById("noteTitle");
            const title = inputTitle.value;
            const inputContent = document.getElementById("noteContent");
            const content = inputContent.value;

            if (inputTitle) {
                if (inputContent){
                    const res = await fetch("http://0.0.0.0:8000/api/v1/notes", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({title, content})
                    });

                    const note = await res.json();
                    noteToHTML(note);
                    inputTitle.value = '';
                    inputContent.value = '';
                }
            }
        })

        async function getAllNotes(){
            const res = await fetch("http://0.0.0.0:8000/api/v1/notes");
            const notes = await res.json();
            console.log(notes);
            notes.forEach(note => noteToHTML(note))
        }
        window.addEventListener('DOMContentLoaded', getAllNotes)

        function noteToHTML({id, title, content}) {
            const noteList = document.getElementById('notes')
            noteList.insertAdjacentHTML('beforeend', `<div id="note${id}" class="row mb-3 card text-bg-light mb-3" >
            <button onclick="deleteNote(${id})" type="button" class="btn-close" aria-label="Close" style="font-size: 20px; position: absolute;left: 1079px;
    top: 5px"></button>
                <label class="form-check-label fs-2 mb-1 mt-1">
                   ${title}
                </label>
                <label class="form-check-label fs-6 mb-2 mt-1">
                    ${content}
                </label>
            </div>
            `);
        }

        async function deleteNote(id) {
            console.log(id);
            const res = await fetch(`http://0.0.0.0:8000/api/v1/notes/${id}`,{
            method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            if (res.status == 204) {
                document.getElementById(`note${id}`).remove();
            }
        }
    </script>
</body>

</html>